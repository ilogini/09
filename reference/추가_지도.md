# 지도 화면 (Tab 4) - 멍이랑 (withbowwow)

> 내 주변의 산책 코스, 반려동물 동반 장소, 동물병원을 한눈에 탐색하는 전체 화면 지도 뷰.
> 네이버 지도/카카오맵 API 기반의 위치 서비스 허브.
> **기존 서브 스크린에서 메인 탭(Tab 4)으로 승격되었으며, 랭킹 탭을 대체한다.**

---

## 1. 페이지 개요

### 1.1 목적

지도 화면은 사용자 위치를 중심으로 주변의 산책 코스, 반려동물 동반 가능 장소(공원, 카페, 상점), 동물병원/약국 등의 정보를 지도 위에 시각적으로 표시하여, 산책 목적지 선정과 주변 편의시설 탐색을 돕는다. 단순한 지도 표시를 넘어, 다른 사용자들의 인기 산책 경로를 히트맵 형태로 오버레이하여 "어디로 산책하면 좋을지"에 대한 실질적인 가이드를 제공한다. **기존에는 홈 화면의 "내 주변" 섹션에서 접근하는 서브 스크린이었으나, NRC 스타일 리디자인에서 하단 탭 바의 4번째 메인 탭으로 승격되었다.**

### 1.2 핵심 사용자 니즈

| 니즈 | 설명 | 우선순위 |
|------|------|---------|
| 코스 탐색 | "오늘은 어디로 산책하지? 새로운 코스를 발견하고 싶다" | 필수 |
| 장소 확인 | "이 근처에 반려동물 동반 가능한 카페가 있나?" | 필수 |
| 편의시설 | "가까운 동물병원이 어디에 있지?" | 필수 |
| 반려동물 상점 | "근처 반려동물 용품 상점이 있나?" | 필수 |
| 안전 확인 | "이 코스가 반려동물 산책에 안전한지 알고 싶다" | 선택 |

### 1.3 진입 경로

| 경로 | 빈도 | 컨텍스트 |
|------|------|---------|
| 하단 탭 바 "지도" 탭 (Tab 4) | 최고 | 메인 탭으로 직접 접근 |
| 홈 → "내 주변" 섹션 → "지도보기" 버튼 | 높음 | 홈에서 미니 지도 확인 후 전체 지도 |
| 산책 준비 화면 → "주변 코스 보기" 링크 | 중간 | 산책 전 코스 탐색 |
| 산책 완료 화면 → "주변 장소 탐색" 버튼 | 낮음 | 산책 후 근처 카페 등 탐색 |

---

## 2. 공통 앱 셸

### 상단 헤더

- **구성**: 앱 로고 (멍이랑) + 알림 벨 아이콘 + 설정 아이콘
- **고정 여부**: `position: sticky` - 스크롤 시에도 항상 상단 고정

### 하단 탭 네비게이션

- **구성**: 홈 / 소셜 / 산책(중앙 플로팅) / **지도(활성)** / MY (5탭)
- **고정 여부**: `position: fixed` - 화면 하단 고정
- **지도 탭 활성 표시**: Primary 컬러 아이콘 + Bold 텍스트

---

## 3. 화면 구성

### 섹션 1: 전체 화면 지도 뷰

#### 콘텐츠 구성

- **지도 엔진**: 네이버 지도 API (메인) / 카카오맵 API (폴백)
- **지도 영역**: 화면 전체를 차지하는 풀스크린 레이아웃 (상단 헤더 뒤로 확장)
- **초기 줌 레벨**: 현재 위치 기준 줌 15 (약 반경 500m 표시)
- **현재 위치 마커**: 파란색 원형 마커 + 방향 표시 + 반경 원(정확도 표시)
- **지도 컨트롤**:
  - 현재 위치 버튼 (우측 하단, FAB 스타일)
  - 줌 인/아웃 (핀치 제스처 + 우측 버튼)
  - 지도 유형 토글 (일반/위성, 좌측 상단)
- **지도 스타일**: 라이트 테마 (밝은 배경, 도로 강조), 다크 모드 시 다크 테마 자동 전환

#### 이 콘텐츠가 있는 이유

> 전체 화면 지도는 Google Maps, 네이버 지도, 카카오맵 등 모든 주요 지도 앱의 표준 패턴이다. Strava의 "Explore" 탭에서도 전체 화면 지도를 기본으로 제공한다.
>
> - **공간 인지(Spatial Cognition)**: 사용자는 텍스트 기반 목록보다 지도 위의 시각적 표현을 통해 주변 환경을 더 직관적으로 이해한다. 인지심리학 연구에 따르면, 공간 정보는 시각적으로 처리될 때 기억 유지율이 65% 높아진다.
> - **탐색 행동 유도**: 전체 화면 지도는 사용자가 자연스럽게 핀치/드래그하여 주변을 탐색하게 만든다. 이는 "앱 체류 시간 증가 → 장소 발견 → 산책 동기 강화"의 선순환을 만든다.
> - **메인 탭 승격 이유**: 기존에는 홈 → "내 주변" → "지도보기"로 2단계를 거쳐야 지도에 접근할 수 있었다. 메인 탭으로 승격하면 어느 화면에서든 한 번의 탭으로 지도에 바로 접근할 수 있어, 사용 빈도와 편의성이 크게 향상된다. NRC에서도 "Explore" 기능을 메인 탭으로 제공한다.

---

### 섹션 2: 산책 코스 오버레이

#### 콘텐츠 구성

- **인기 코스 Polyline**: 다른 사용자들이 자주 걷는 경로를 반투명 Polyline으로 표시
  - 색상: Primary(#10B981) 반투명 (opacity 0.4)
  - 두께: 이용 빈도에 비례 (최소 3px ~ 최대 8px)
  - 탭 시: 코스 이름, 거리, 평균 소요 시간, 이용자 수 표시
- **추천 코스 하이라이트**: 앱이 추천하는 코스는 Primary 컬러 실선 (opacity 0.8)으로 강조
- **코스 시작점 마커**: 초록색 원형 마커 + 코스 이름 레이블
- **코스 정보 칩**: 지도 위에 "3.2km / 약 40분" 형태의 소형 정보 칩 오버레이
- **히트맵 모드 토글**: 개별 코스 대신 산책 밀도 히트맵으로 전환 가능 (빨강>노랑>초록 그라데이션)

#### 이 콘텐츠가 있는 이유

> 산책 코스 오버레이는 Strava의 "Global Heatmap" 기능에서 영감을 받았다. Strava는 전 세계 러너/라이더의 활동 데이터를 히트맵으로 시각화하여 인기 경로를 보여준다.
>
> - **사회적 증거(Social Proof)**: "다른 사람들이 많이 걷는 길"은 곧 "안전하고 좋은 길"이라는 암묵적 신뢰를 형성한다. 로버트 치알디니의 설득의 심리학에서 사회적 증거는 6가지 설득 원칙 중 하나로, 특히 불확실한 상황(어디로 산책할지 모를 때)에서 가장 강력하게 작용한다.
> - **탐험 뱃지 연동**: 새로운 코스를 발견하고 방문하면 탐험 뱃지 진행률이 올라가므로, 지도 화면은 뱃지 시스템과의 시너지를 통해 사용자의 활동 범위 확장을 자연스럽게 유도한다.
> - **데이터 네트워크 효과**: 사용자가 많아질수록 코스 데이터가 풍부해지고, 더 정확한 추천이 가능해지며, 이는 다시 더 많은 사용자를 끌어들이는 네트워크 효과를 생성한다.

---

### 섹션 3: 장소 핀 (반려동물 동반 가능)

#### 콘텐츠 구성

- **핀 유형 및 아이콘**:

| 핀 유형 | 아이콘 | 색상 | 데이터 소스 |
|---------|--------|------|------------|
| 공원/놀이터 | 나무 아이콘 | 초록(#10B981) | 공공데이터: 반려동물 놀이터 |
| 반려동물 카페 | 커피잔 + 발바닥 | 주황(#F59E0B) | 카카오 로컬 API 검색 |
| **반려동물 상점** | **장바구니 + 발바닥** | **보라(#8B5CF6)** | **카카오 로컬 API 검색** |
| 동물병원 | 십자가 아이콘 | 빨강(#EF4444) | 공공데이터: 동물병원 현황 |
| 동물약국 | 약 아이콘 | 파랑(#3B82F6) | 공공데이터 |

- **핀 크기**: 줌 레벨에 따라 동적 조절 (줌 아웃 시 클러스터링)
- **핀 클러스터링**: 동일 영역에 핀이 5개 이상일 때 숫자 표시 원형 클러스터로 병합
- **핀 탭 인터랙션**: 탭 시 핀 위에 미니 프리뷰 카드 표시 (장소명 + 거리 + 평점)
- **핀 프리뷰 카드 탭 시**: 상세 바텀시트 올라옴

#### 이 콘텐츠가 있는 이유

> 장소 핀 시스템은 Google Maps의 POI(Point of Interest) 표시와 카카오맵의 카테고리별 핀 색상 구분을 결합한 패턴이다.
>
> - **정보 최소화 원칙**: 핀 색상과 아이콘만으로 장소 유형을 즉시 구분할 수 있어, 지도를 보는 순간 "초록색은 공원, 빨간색은 병원, 보라색은 상점"이라는 직관적 인지가 가능하다.
> - **클러스터링의 필요성**: 핀이 너무 많으면 지도가 어지러워져 정보 가치가 떨어진다. 줌 레벨에 따라 정보 밀도를 자동 조절한다.
> - **긴급 상황 대응**: 동물병원/약국 핀은 산책 중 반려동물 건강 이상 시 즉각적인 대응을 가능하게 한다.
> - **상점 카테고리 추가 이유**: 반려동물 용품(간식, 장난감, 용품)을 구매할 수 있는 상점 정보는 산책 중 또는 산책 후 사용자의 실질적인 니즈를 충족한다. 이는 향후 제휴 상점 광고 수익 모델의 기반이 된다.

---

### 섹션 4: 장소 상세 바텀시트

#### 콘텐츠 구성

- **트리거**: 핀 프리뷰 카드 탭 또는 핀 롱프레스
- **바텀시트 높이**: 초기 30% (미니), 드래그 시 60% (풀)
- **미니 모드 (30%)**:
  - 장소명 (18pt Bold)
  - 카테고리 태그 (공원/카페/상점/병원/약국 칩)
  - 별점 (별 아이콘 + 숫자, 예: 4.3)
  - 현재 위치에서 거리 ("350m")
  - 영업 상태 ("영업 중" 초록 / "영업 종료" 빨강)
- **풀 모드 (60%)** - 추가 표시:
  - 상세 주소 (도로명주소)
  - 영업시간 (요일별)
  - 전화번호 (탭하여 전화 연결)
  - 사용자 리뷰 요약 (최근 3개)
  - 반려동물 관련 정보:
    - 대형견 입장 가능 여부
    - 리드줄 필수 여부
    - 반려동물 전용 시설 (물그릇, 놀이 공간 등)
  - 길찾기 버튼 (네이버 지도/카카오맵 앱 연동)
  - 산책 시작 버튼 ("이 장소까지 산책 시작")

#### 이 콘텐츠가 있는 이유

> 장소 상세 바텀시트는 Google Maps와 네이버 지도의 장소 상세 패턴을 기반으로, 반려동물 특화 정보를 추가한 확장 설계이다.
>
> - **점진적 정보 공개(Progressive Disclosure)**: 미니 모드에서 핵심 정보(이름, 거리, 영업 상태)만 먼저 보여주고, 상세 정보는 사용자가 능동적으로 드래그할 때만 표시한다.
> - **반려동물 특화 정보의 차별화**: 일반 지도 앱에서 제공하지 않는 "대형견 입장 가능 여부", "리드줄 필수" 등의 정보는 멍이랑만의 핵심 차별점이다.
> - **행동 전환(CTA) 설계**: "이 장소까지 산책 시작" 버튼은 정보 탐색에서 실제 산책 행동으로의 전환을 유도한다.

---

### 섹션 5: 필터 시스템

#### 콘텐츠 구성

- **필터 버튼 바**: 지도 상단에 수평 배치 (지도 위에 플로팅)
- **필터 칩 목록**:

| 필터 | 아이콘 | 기본 상태 |
|------|--------|----------|
| 산책 코스 | 경로 아이콘 | ON |
| 공원 | 나무 아이콘 | ON |
| 카페 | 커피잔 아이콘 | OFF |
| **상점** | **장바구니 아이콘** | **OFF** |
| 병원 | 십자가 아이콘 | OFF |
| 약국 | 약 아이콘 | OFF |

- **필터 칩 스타일**:
  - ON: Primary 배경 + 흰색 텍스트 + 아이콘
  - OFF: 흰색 배경 + Gray 텍스트 + 아이콘 + 그림자
- **필터 동작**: 탭하여 ON/OFF 토글, 복수 선택 가능
- **필터 적용 시**: 핀이 페이드 인/아웃 애니메이션으로 표시/숨김

#### 이 콘텐츠가 있는 이유

> 필터 칩 패턴은 Google Maps의 상단 카테고리 필터(식당, 주유소, 약국 등)에서 차용한 검증된 UX 패턴이다.
>
> - **인지 부하 관리**: 모든 핀 유형을 동시에 표시하면 지도가 복잡해져 원하는 정보를 찾기 어렵다. 필터를 통해 사용자가 현재 관심사에 맞는 정보만 선택적으로 볼 수 있게 한다.
> - **기본 ON/OFF 설정 전략**: "산책 코스"와 "공원"을 기본 ON으로 설정한 이유는, 지도 탭 진입의 주요 동기가 "어디로 산책할지"를 탐색하는 것이기 때문이다. 병원/약국/상점은 필요한 상황에서만 활성화하여 평소에는 지도를 깔끔하게 유지한다.
> - **상점 필터 추가**: 반려동물 용품 상점을 별도 필터로 제공하여, 산책 중 또는 산책 후 간식/용품을 구매하려는 사용자 니즈를 충족한다.

---

## 4. UX 설계 의도

### 4.1 정보 계층 구조

```
Level 1 (배경): 전체 화면 지도 — 공간적 맥락 제공
Level 2 (오버레이): 산책 코스 Polyline — 경로 탐색
Level 3 (핀): 장소 마커 — 주변 시설 위치
Level 4 (프리뷰): 핀 탭 미니 카드 — 핵심 정보 스캔
Level 5 (상세): 바텀시트 — 의사결정 정보 제공
Level 6 (행동): CTA 버튼 — 산책 시작 / 길찾기
```

지도 화면의 정보 계층은 "환경 인식 → 탐색 → 발견 → 확인 → 행동"의 자연스러운 탐색 흐름을 따른다. 사용자는 지도를 훑어보며(Level 1-2) 관심 있는 핀을 발견하고(Level 3), 탭하여 미리보기를 확인한 뒤(Level 4), 상세 정보를 열어(Level 5) 최종적으로 행동(Level 6)으로 이어진다.

### 4.2 인터랙션 패턴

| 인터랙션 | 동작 | 피드백 |
|---------|------|--------|
| 지도 팬/드래그 | 한 손가락 드래그 | 관성 스크롤 + 지도 이동 |
| 핀치 줌 | 두 손가락 핀치 | 부드러운 줌 + 클러스터링 갱신 |
| 핀 탭 | 마커 터치 | 마커 바운스 + 미니 카드 슬라이드업 |
| 필터 토글 | 칩 탭 | 칩 색상 전환 + 핀 페이드 인/아웃 |
| 바텀시트 드래그 | 시트 상단 드래그 | 미니 ↔ 풀 전환 |
| 현재 위치 버튼 | FAB 탭 | 현재 위치로 지도 이동 + 줌 리셋 |
| 코스 Polyline 탭 | 경로 위 터치 | 코스 정보 팝업 |
| 길찾기 버튼 | 바텀시트 내 탭 | 외부 지도 앱 실행 (딥링크) |

### 4.3 접근성 고려사항

- **VoiceOver/TalkBack**: 핀에 `accessibilityLabel` 적용 (예: "보라매공원, 현재 위치에서 350미터, 별점 4.3")
- **색각 이상 대응**: 핀 유형을 색상뿐 아니라 아이콘 형태로도 구분 (색상만에 의존하지 않음)
- **대형 터치 영역**: 핀 터치 영역 최소 44x44pt, 필터 칩 최소 높이 36pt
- **현재 위치 버튼**: 위치 서비스 비활성화 시 설정 안내 다이얼로그 표시
- **오프라인 대응**: 네트워크 연결 없을 시 캐시된 지도 + "오프라인 상태" 배너 표시
- **다크 모드**: 지도 다크 테마 자동 적용, 핀 색상은 다크 배경에서 가시성 유지

---

## 5. 와이어프레임 (ASCII)

```
┌──────────────────────────────┐
│  멍이랑          [알림] [설정]│  ← 고정 헤더
├──────────────────────────────┤
│ [코스][공원][카페][상점][병원] │  ← 필터 칩 바 (플로팅, 가로 스크롤)
├──────────────────────────────┤
│                              │
│    🌳          ☕             │  ← 장소 핀들
│         ···경로···           │  ← 인기 코스 Polyline
│    🌳   ···경로···    🏥     │
│              📍 ← 내 위치    │  ← 현재 위치 마커
│    ···경로···      🛒        │  ← 상점 핀
│         🌳     ☕            │
│                   💊         │
│                              │
│                  ┌────────┐  │
│                  │ 📍 현위치│  │  ← 현재 위치 FAB
│                  └────────┘  │
│                              │
│ ┌──────────────────────────┐ │  ← 핀 탭 시 미니 카드
│ │ 🌳 보라매공원  350m  ⭐4.3│ │
│ │    반려동물 동반 가능      │ │
│ └──────────────────────────┘ │
├──────────────────────────────┤
│  [🏠] [👥] [🐾] [📍] [👤]   │  ← 하단 탭 바 (지도 활성)
│   홈   소셜  산책  지도  MY   │
└──────────────────────────────┘

── 장소 상세 바텀시트 (풀 모드) ──
┌──────────────────────────────┐
│          ─── (드래그 핸들)    │
│                              │
│  🌳 보라매공원               │  ← 장소명
│  [공원] ⭐ 4.3 (128)  350m  │  ← 태그, 별점, 거리
│  🟢 영업 중                  │  ← 영업 상태
│                              │
│  📍 서울 동작구 보라매로 33   │  ← 주소
│  📞 02-1234-5678             │  ← 전화번호
│  🕐 06:00 - 22:00            │  ← 영업시간
│                              │
│  🐾 반려동물 정보             │  ← 반려동물 특화 정보
│  ├─ 대형견 입장: ✅ 가능      │
│  ├─ 리드줄: ⚠️ 필수          │
│  └─ 전용 시설: 물그릇, 놀이터 │
│                              │
│  💬 최근 리뷰                 │  ← 리뷰 요약
│  "넓은 잔디밭이 있어서..."    │
│                              │
│  [길찾기]  [이 장소로 산책!]  │  ← CTA 버튼
└──────────────────────────────┘
```

---

## 6. 기술 구현 참고사항

### 6.1 지도 API 선택 기준

| 기준 | 네이버 지도 | 카카오맵 |
|------|------------|---------|
| React Native 지원 | react-native-naver-map | react-native-maps (카카오 어댑터) |
| 일일 무료 호출 | 200,000건 | 300,000건 |
| Polyline 지원 | O | O |
| 클러스터링 | 자체 구현 필요 | 자체 구현 필요 |
| 커스텀 마커 | O | O |
| 다크 테마 | O | 제한적 |

### 6.2 공공데이터 연동

| 데이터 | API | 갱신 주기 |
|--------|-----|----------|
| 동물병원 현황 | 공공데이터포털 | 월 1회 |
| 반려동물 놀이터 | 공공데이터포털 | 분기 1회 |
| 반려동물 카페 | 카카오 로컬 API 실시간 검색 | 실시간 |
| 반려동물 상점 | 카카오 로컬 API 실시간 검색 | 실시간 |

### 6.3 주변 장소 검색 SQL 예시

```sql
-- 현재 위치 기준 반경 내 장소 검색
SELECT
  id,
  name,
  category,
  ST_Distance(
    location::geography,
    ST_MakePoint(:lng, :lat)::geography
  ) AS distance_m,
  rating,
  is_open,
  pet_friendly_info
FROM places
WHERE ST_DWithin(
  location::geography,
  ST_MakePoint(:lng, :lat)::geography,
  :radius_m  -- 검색 반경 (미터)
)
AND category = ANY(:categories)  -- 필터링된 카테고리
ORDER BY distance_m ASC
LIMIT 50;
```

---

## 7. 데이터 요구사항

| 데이터 | API/소스 | 갱신 주기 |
|--------|---------|----------|
| 장소 정보 | Supabase (places 테이블) + 공공데이터 | 월/분기별 동기화 |
| 산책 코스 | Supabase (walks 집계) | 주간 배치 처리 |
| 히트맵 데이터 | Supabase (walks GPS 집계) | 주간 배치 처리 |
| 사용자 리뷰 | Supabase (place_reviews 테이블) | 실시간 |
| 영업 상태 | 카카오 로컬 API | 실시간 |

---

*작성일: 2026-02-12*
*수정일: 2026-02-19 (NRC 스타일 리디자인: 메인 탭 승격, 상점 카테고리 추가, 공통 헤더/탭바 반영)*
*버전: 2.0*
